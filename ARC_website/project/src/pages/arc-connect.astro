---
import Layout from '../layouts/Layout.astro';
import QrScanReact from '../components/QrScanReact.jsx';
---
<Layout title="ARC configuration">
    <div class="max-w-xl mx-auto mt-20 mb-16 p-6 py-8 bg-gray-50 dark:bg-gray-900 rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Send Files to ARC</h2>

        <label for="ip" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Enter or Scan ARC IP:</label>
        <input
                type="text"
                id="ip"
                name="ip"
                placeholder="192.168.x.x"
                class="w-full p-2 mb-4 mt-1 rounded border dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"
        />

        <QrScanReact client:only="react" onDetected={val => document.getElementById('ip').value = val} />

        <form id="uploadForm" class="space-y-4">
            <div>
                <label for="file" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Choose file to send:</label>
                <input type="file" id="file" required class="block mt-1" />
            </div>
            <button
                    type="submit"
                    class="w-full px-4 py-2 bg-accent hover:bg-accent-hover text-white rounded shadow transition"
            >
                Send to ARC
            </button>
        </form>
        <p id="status" class="mt-4 text-sm text-gray-700 dark:text-gray-300"></p>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const ipInput = document.getElementById('ip');
            const form = document.getElementById('uploadForm');
            const status = document.getElementById('status');
            form.onsubmit = async (e) => {
                e.preventDefault();
                const ip = ipInput.value.trim();
                const file = document.getElementById('file').files[0];
                if (!ip || !file) return alert("Enter IP and select a file.");

                const formData = new FormData();
                formData.append("file", file);

                try {
                    const response = await fetch(`http://${ip}:5000/upload`, {
                        method: "POST",
                        body: formData,
                    });

                    status.textContent = response.ok
                        ? "✅ File sent successfully!"
                        : "❌ Error uploading file.";
                } catch (err) {
                    status.textContent = "❌ Could not connect to ARC.";
                    console.error(err);
                }
            };
        });
    </script>
</Layout>
